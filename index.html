<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–∏–º—É–ª—è—Ç–æ—Ä –∫–µ–π—Å–æ–≤ —Å —Ñ–∏–≥—É—Ä–∫–∞–º–∏</title>
    <style>
        :root {
            --primary-color: #ffcc00;
            --secondary-color: #ff6b00;
            --dark-bg: #1a1a1a;
            --darker-bg: #121212;
            --item-bg: #333;
            --success-color: #33cc33;
            --danger-color: #ff3333;
            --rare-color: #4d88ff;
            --epic-color: #b347ea;
            --legendary-color: #ffaa00;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--dark-bg);
            color: white;
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        h1 {
            text-align: center;
            color: var(--primary-color);
            margin-bottom: 20px;
            text-shadow: 0 0 10px rgba(255, 204, 0, 0.3);
            font-size: 2.5rem;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #333;
        }
        
        .tab {
            padding: 12px 25px;
            cursor: pointer;
            background-color: #333;
            border: none;
            color: white;
            font-weight: bold;
            border-radius: 5px 5px 0 0;
            margin-right: 5px;
            transition: all 0.3s;
        }
        
        .tab.active {
            background-color: var(--primary-color);
            color: #1a1a1a;
        }
        
        .tab:hover:not(.active) {
            background-color: #444;
        }
        
        .tab-content {
            display: none;
            animation: fadeIn 0.5s;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .balance {
            background-color: #333;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .balance-item {
            display: flex;
            align-items: center;
        }
        
        .balance-icon {
            font-size: 1.2rem;
            margin-right: 8px;
            color: var(--primary-color);
        }
        
        .cases-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .case {
            background: linear-gradient(145deg, #3a3a3a, #2e2e2e);
            border-radius: 12px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
            border: 2px solid #444;
        }
        
        .case:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
            border-color: var(--primary-color);
        }
        
        .case::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                to bottom right,
                rgba(255, 255, 255, 0) 0%,
                rgba(255, 255, 255, 0) 30%,
                rgba(255, 255, 255, 0.1) 45%,
                rgba(255, 255, 255, 0) 60%,
                rgba(255, 255, 255, 0) 100%
            );
            transform: rotate(30deg);
            transition: all 0.5s;
        }
        
        .case:hover::before {
            left: 100%;
            top: 100%;
        }
        
        .case-img-container {
            position: relative;
            width: 100%;
            height: 180px;
            margin-bottom: 15px;
            border-radius: 8px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #222;
        }
        
        .case img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s;
        }
        
        .case:hover img {
            transform: scale(1.05);
        }
        
        .case h3 {
            margin: 10px 0 5px;
            font-size: 1.2rem;
            text-align: center;
        }
        
        .case .price {
            color: var(--primary-color);
            font-weight: bold;
            font-size: 1.1rem;
            text-align: center;
            margin-bottom: 5px;
        }
        
        .case .limited {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: var(--danger-color);
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        
        .rarity {
            position: absolute;
            bottom: 10px;
            left: 10px;
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 11px;
            font-weight: bold;
            text-transform: uppercase;
        }
        
        .common { background-color: #aaa; color: #333; }
        .rare { background-color: var(--rare-color); color: white; }
        .epic { background-color: var(--epic-color); color: white; }
        .legendary { background-color: var(--legendary-color); color: #333; }
        
        .animation-container {
            height: 200px;
            overflow: hidden;
            position: relative;
            margin: 30px 0;
            background-color: #222;
            border-radius: 10px;
            display: none;
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.5);
        }
        
        .animation-items {
            display: flex;
            position: absolute;
            left: 0;
            transition: left 0.1s;
            height: 100%;
        }
        
        .animation-item {
            width: 180px;
            height: 100%;
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-color: #333;
            margin-right: 5px;
            border-radius: 8px;
            position: relative;
            overflow: hidden;
            border: 2px solid #444;
        }
        
        .animation-item.highlight {
            animation: highlight 0.5s infinite alternate;
        }
        
        @keyframes highlight {
            from { border-color: #444; box-shadow: none; }
            to { border-color: var(--primary-color); box-shadow: 0 0 20px var(--primary-color); }
        }
        
        .animation-item img {
            width: 120px;
            height: 120px;
            object-fit: cover;
            transition: transform 0.3s;
        }
        
        .animation-item .name {
            font-size: 14px;
            margin-top: 10px;
            text-align: center;
            padding: 0 5px;
        }
        
        .result {
            text-align: center;
            margin: 30px 0;
            font-size: 28px;
            color: var(--primary-color);
            display: none;
            text-shadow: 0 0 10px rgba(255, 204, 0, 0.5);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            display: none;
        }
        
        button {
            padding: 12px 25px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .sell-btn {
            background-color: var(--danger-color);
            color: white;
        }
        
        .sell-btn:hover {
            background-color: #e60000;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 51, 51, 0.4);
        }
        
        .keep-btn {
            background-color: var(--success-color);
            color: white;
        }
        
        .keep-btn:hover {
            background-color: #29a329;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(51, 204, 51, 0.4);
        }
        
        .inventory-items {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 20px;
        }
        
        .inventory-item {
            background: linear-gradient(145deg, #3a3a3a, #2e2e2e);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            transition: all 0.3s;
            position: relative;
            border: 2px solid #444;
        }
        
        .inventory-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        
        .inventory-item img {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 5px;
            margin-bottom: 10px;
            border: 2px solid #444;
        }
        
        .inventory-item .name {
            font-size: 14px;
            margin: 5px 0;
            font-weight: bold;
        }
        
        .inventory-item .price {
            color: var(--primary-color);
            font-size: 14px;
            margin-bottom: 10px;
        }
        
        .inventory-item .level {
            position: absolute;
            top: 10px;
            left: 10px;
            background-color: var(--primary-color);
            color: #333;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 12px;
        }
        
        .item-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }
        
        .sell-inventory-btn {
            background-color: var(--danger-color);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 5px 10px;
            font-size: 12px;
            cursor: pointer;
            flex: 1;
            margin-right: 5px;
            transition: all 0.3s;
        }
        
        .sell-inventory-btn:hover {
            background-color: #e60000;
        }
        
        .upgrade-inventory-btn {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 5px 10px;
            font-size: 12px;
            cursor: pointer;
            flex: 1;
            transition: all 0.3s;
        }
        
        .upgrade-inventory-btn:hover {
            background-color: #e05d00;
        }
        
        .upgrade-container {
            background-color: #333;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .upgrade-info {
            margin-bottom: 20px;
            padding: 15px;
            background-color: #444;
            border-radius: 8px;
        }
        
        .upgrade-item {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding: 15px;
            background-color: #444;
            border-radius: 8px;
            transition: all 0.3s;
        }
        
        .upgrade-item:hover {
            background-color: #555;
        }
        
        .upgrade-item img {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 5px;
            margin-right: 15px;
            border: 2px solid #555;
        }
        
        .upgrade-item-info {
            flex: 1;
        }
        
        .upgrade-item-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .upgrade-item-stats {
            display: flex;
            font-size: 14px;
            color: #aaa;
            margin-bottom: 5px;
        }
        
        .upgrade-item-price {
            color: var(--primary-color);
            font-weight: bold;
        }
        
        .upgrade-item-chance {
            color: var(--success-color);
            font-weight: bold;
        }
        
        .upgrade-btn {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 5px;
            padding: 8px 15px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .upgrade-btn:hover {
            background-color: #e05d00;
            transform: translateY(-2px);
        }
        
        .upgrade-btn:disabled {
            background-color: #666;
            cursor: not-allowed;
            transform: none;
        }
        
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background-color: var(--primary-color);
            opacity: 0;
            animation: confetti-fall 5s linear forwards;
            z-index: 1000;
        }
        
        @keyframes confetti-fall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1001;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background-color: #333;
            padding: 30px;
            border-radius: 10px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            position: relative;
            animation: modalAppear 0.5s;
        }
        
        @keyframes modalAppear {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        
        .modal-title {
            color: var(--primary-color);
            margin-bottom: 20px;
            font-size: 1.5rem;
        }
        
        .modal-text {
            margin-bottom: 20px;
            font-size: 1.1rem;
        }
        
        .modal-close {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        .progress-bar {
            height: 20px;
            background-color: #444;
            border-radius: 10px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .progress {
            height: 100%;
            background: linear-gradient(to right, var(--secondary-color), var(--primary-color));
            width: 0%;
            transition: width 1s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: white;
            font-weight: bold;
        }
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            .cases-container {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
            
            .inventory-items {
                grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
            }
            
            .animation-item {
                width: 150px;
            }
            
            .animation-item img {
                width: 100px;
                height: 100px;
            }
            
            h1 {
                font-size: 1.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>‚ú® –°–∏–º—É–ª—è—Ç–æ—Ä –∫–µ–π—Å–æ–≤ —Å —Ñ–∏–≥—É—Ä–∫–∞–º–∏ ‚ú®</h1>
        
        <div class="balance">
            <div class="balance-item">
                <span class="balance-icon">üí∞</span>
                –ë–∞–ª–∞–Ω—Å: <span id="money">1000</span> ‚ÇΩ
            </div>
            <div class="balance-item">
                <span class="balance-icon">üéÅ</span>
                –û—Ç–∫—Ä—ã—Ç–æ: <span id="opened-cases">0</span>
            </div>
            <div class="balance-item">
                <span class="balance-icon">üîë</span>
                –ö–ª—é—á–∏: <span id="keys">0</span>
            </div>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="openTab('cases-tab')">–ö–µ–π—Å—ã</button>
            <button class="tab" onclick="openTab('inventory-tab')">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</button>
            <button class="tab" onclick="openTab('upgrade-tab')">–ê–ø–≥—Ä–µ–π–¥</button>
        </div>
        
        <div id="cases-tab" class="tab-content active">
            <h2>–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–µ–π—Å—ã</h2>
            <div class="cases-container">
                <div class="case" onclick="openCase(0)">
                    <div class="case-img-container">
                        <img src="https://via.placeholder.com/300/aaa/000?text=–û–±—ã—á–Ω—ã–π" alt="–û–±—ã—á–Ω—ã–π –∫–µ–π—Å">
                        <div class="rarity common">–û–±—ã—á–Ω—ã–π</div>
                    </div>
                    <h3>–û–±—ã—á–Ω—ã–π –∫–µ–π—Å</h3>
                    <div class="price">100 ‚ÇΩ</div>
                </div>
                
                <div class="case" onclick="openCase(1)">
                    <div class="case-img-container">
                        <img src="https://via.placeholder.com/300/4d88ff/fff?text=–†–µ–¥–∫–∏–π" alt="–†–µ–¥–∫–∏–π –∫–µ–π—Å">
                        <div class="rarity rare">–†–µ–¥–∫–∏–π</div>
                    </div>
                    <h3>–†–µ–¥–∫–∏–π –∫–µ–π—Å</h3>
                    <div class="price">300 ‚ÇΩ</div>
                </div>
                
                <div class="case" onclick="openCase(2)">
                    <div class="case-img-container">
                        <img src="https://via.placeholder.com/300/b347ea/fff?text=–≠–ø–∏—á–µ—Å–∫–∏–π" alt="–≠–ø–∏—á–µ—Å–∫–∏–π –∫–µ–π—Å">
                        <div class="rarity epic">–≠–ø–∏—á–µ—Å–∫–∏–π</div>
                    </div>
                    <h3>–≠–ø–∏—á–µ—Å–∫–∏–π –∫–µ–π—Å</h3>
                    <div class="price">500 ‚ÇΩ</div>
                    <div class="limited">–û—Å—Ç–∞–ª–æ—Å—å: <span id="limited-count">5</span></div>
                </div>
                
                <div class="case" onclick="openCase(3)">
                    <div class="case-img-container">
                        <img src="https://via.placeholder.com/300/ffaa00/000?text=–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π" alt="–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π –∫–µ–π—Å">
                        <div class="rarity legendary">–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π</div>
                    </div>
                    <h3>–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π –∫–µ–π—Å</h3>
                    <div class="price">1000 ‚ÇΩ</div>
                    <div class="limited">–û—Å—Ç–∞–ª–æ—Å—å: <span id="legendary-count">3</span></div>
                </div>
            </div>
            
            <div class="animation-container" id="animation-container">
                <div class="animation-items" id="animation-items"></div>
            </div>
            
            <div class="result" id="result"></div>
            
            <div class="buttons" id="buttons">
                <button class="sell-btn" onclick="sellItem()">–ü—Ä–æ–¥–∞—Ç—å</button>
                <button class="keep-btn" onclick="keepItem()">–û—Å—Ç–∞–≤–∏—Ç—å</button>
            </div>
        </div>
        
        <div id="inventory-tab" class="tab-content">
            <h2>–í–∞—à –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å</h2>
            <p id="empty-inventory" style="text-align: center; color: #aaa; display: none;">–í–∞—à –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å –ø—É—Å—Ç. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–µ–π—Å—ã, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —Ñ–∏–≥—É—Ä–∫–∏!</p>
            <div class="inventory-items" id="inventory-items">
                <!-- –ó–¥–µ—Å—å –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ —Ñ–∏–≥—É—Ä–∫–∏ -->
            </div>
        </div>
        
        <div id="upgrade-tab" class="tab-content">
            <h2>–£–ª—É—á—à–µ–Ω–∏–µ —Ñ–∏–≥—É—Ä–æ–∫</h2>
            <div class="upgrade-container">
                <div class="upgrade-info">
                    <h3>–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?</h3>
                    <p>–í—ã–±–µ—Ä–∏—Ç–µ –¥–≤–µ —Ñ–∏–≥—É—Ä–∫–∏ –æ–¥–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è –¥–ª—è –ø–æ–ø—ã—Ç–∫–∏ —É–ª—É—á—à–µ–Ω–∏—è. –ü—Ä–∏ —É—Å–ø–µ—Ö–µ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ —Ñ–∏–≥—É—Ä–∫—É —Å–ª–µ–¥—É—é—â–µ–≥–æ —É—Ä–æ–≤–Ω—è, –ø—Ä–∏ –Ω–µ—É–¥–∞—á–µ - –ø–æ—Ç–µ—Ä—è–µ—Ç–µ –æ–±–µ —Ñ–∏–≥—É—Ä–∫–∏.</p>
                    <div class="progress-bar">
                        <div class="progress" id="upgrade-progress">0%</div>
                    </div>
                    <p>–®–∞–Ω—Å —É—Å–ø–µ—Ö–∞: <span id="upgrade-chance">0</span>%</p>
                </div>
                
                <h3>–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∏–≥—É—Ä–∫–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è:</h3>
                <div id="upgrade-items">
                    <!-- –ó–¥–µ—Å—å –±—É–¥—É—Ç —Ñ–∏–≥—É—Ä–∫–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è -->
                </div>
                
                <button id="perform-upgrade" class="upgrade-btn" disabled onclick="performUpgrade()">–£–ª—É—á—à–∏—Ç—å</button>
            </div>
        </div>
    </div>
    
    <div id="upgrade-modal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal()">&times;</button>
            <h2 class="modal-title" id="upgrade-modal-title">–†–µ–∑—É–ª—å—Ç–∞—Ç —É–ª—É—á—à–µ–Ω–∏—è</h2>
            <p class="modal-text" id="upgrade-modal-text"></p>
            <div id="upgrade-modal-item"></div>
            <button class="upgrade-btn" onclick="closeModal()">OK</button>
        </div>
    </div>
    
    <div id="key-modal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal()">&times;</button>
            <h2 class="modal-title">üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! üéâ</h2>
            <p class="modal-text">–í—ã –ø–æ–ª—É—á–∏–ª–∏ –∫–ª—é—á –æ—Ç –∫–µ–π—Å–∞!</p>
            <p>–¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –æ—Ç–∫—Ä—ã—Ç—å –æ–¥–∏–Ω –∫–µ–π—Å –±–µ—Å–ø–ª–∞—Ç–Ω–æ.</p>
            <button class="upgrade-btn" onclick="closeModal()">–û—Ç–ª–∏—á–Ω–æ!</button>
        </div>
    </div>

    <script>
        // –î–∞–Ω–Ω—ã–µ –æ —Ñ–∏–≥—É—Ä–∫–∞—Ö –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–µ–π—Å–∞
        const caseItems = [
            // –û–±—ã—á–Ω—ã–π –∫–µ–π—Å
            [
                { name: "–û–±—ã—á–Ω–∞—è —Ñ–∏–≥—É—Ä–∫–∞ 1", price: 50, image: "https://via.placeholder.com/200/aaa/000?text=–û–±—ã—á1", rarity: "common", level: 1, id: 1 },
                { name: "–û–±—ã—á–Ω–∞—è —Ñ–∏–≥—É—Ä–∫–∞ 2", price: 70, image: "https://via.placeholder.com/200/aaa/000?text=–û–±—ã—á2", rarity: "common", level: 1, id: 2 },
                { name: "–†–µ–¥–∫–∞—è —Ñ–∏–≥—É—Ä–∫–∞ 1", price: 150, image: "https://via.placeholder.com/200/4d88ff/fff?text=–†–µ–¥–∫1", rarity: "rare", level: 1, id: 3 },
                { name: "–†–µ–¥–∫–∞—è —Ñ–∏–≥—É—Ä–∫–∞ 2", price: 200, image: "https://via.placeholder.com/200/4d88ff/fff?text=–†–µ–¥–∫2", rarity: "rare", level: 1, id: 4 },
                { name: "–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω–∞—è —Ñ–∏–≥—É—Ä–∫–∞", price: 500, image: "https://via.placeholder.com/200/ffaa00/000?text=–õ–µ–≥–µ–Ω–¥–∞", rarity: "legendary", level: 1, id: 5 }
            ],
            // –†–µ–¥–∫–∏–π –∫–µ–π—Å
            [
                { name: "–†–µ–¥–∫–∞—è —Ñ–∏–≥—É—Ä–∫–∞ A", price: 200, image: "https://via.placeholder.com/200/4d88ff/fff?text=–†–µ–¥–∫A", rarity: "rare", level: 1, id: 6 },
                { name: "–†–µ–¥–∫–∞—è —Ñ–∏–≥—É—Ä–∫–∞ B", price: 250, image: "https://via.placeholder.com/200/4d88ff/fff?text=–†–µ–¥–∫B", rarity: "rare", level: 1, id: 7 },
                { name: "–≠–ø–∏—á–µ—Å–∫–∞—è —Ñ–∏–≥—É—Ä–∫–∞ X", price: 400, image: "https://via.placeholder.com/200/b347ea/fff?text=–≠–ø–∏–∫X", rarity: "epic", level: 1, id: 8 },
                { name: "–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω–∞—è —Ñ–∏–≥—É—Ä–∫–∞ Y", price: 800, image: "https://via.placeholder.com/200/ffaa00/000?text=–õ–µ–≥–µ–Ω–¥–∞Y", rarity: "legendary", level: 1, id: 9 }
            ],
            // –≠–ø–∏—á–µ—Å–∫–∏–π –∫–µ–π—Å
            [
                { name: "–≠–ø–∏—á–µ—Å–∫–∞—è —Ñ–∏–≥—É—Ä–∫–∞ 1", price: 400, image: "https://via.placeholder.com/200/b347ea/fff?text=–≠–ø–∏–∫1", rarity: "epic", level: 1, id: 10 },
                { name: "–≠–ø–∏—á–µ—Å–∫–∞—è —Ñ–∏–≥—É—Ä–∫–∞ 2", price: 600, image: "https://via.placeholder.com/200/b347ea/fff?text=–≠–ø–∏–∫2", rarity: "epic", level: 1, id: 11 },
                { name: "–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω–∞—è —Ñ–∏–≥—É—Ä–∫–∞ Z", price: 1000, image: "https://via.placeholder.com/200/ffaa00/000?text=–õ–µ–≥–µ–Ω–¥–∞Z", rarity: "legendary", level: 1, id: 12 },
                { name: "–ó–æ–ª–æ—Ç–∞—è —Ñ–∏–≥—É—Ä–∫–∞", price: 2000, image: "https://via.placeholder.com/200/gold/000?text=–ó–æ–ª–æ—Ç–æ", rarity: "legendary", level: 1, id: 13 }
            ],
            // –õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π –∫–µ–π—Å
            [
                { name: "–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω–∞—è —Ñ–∏–≥—É—Ä–∫–∞ Alpha", price: 1000, image: "https://via.placeholder.com/200/ffaa00/000?text=Alpha", rarity: "legendary", level: 1, id: 14 },
                { name: "–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω–∞—è —Ñ–∏–≥—É—Ä–∫–∞ Beta", price: 1200, image: "https://via.placeholder.com/200/ffaa00/000?text=Beta", rarity: "legendary", level: 1, id: 15 },
                { name: "–ú–∏—Ñ–∏—á–µ—Å–∫–∞—è —Ñ–∏–≥—É—Ä–∫–∞", price: 3000, image: "https://via.placeholder.com/200/ff3333/fff?text=–ú–∏—Ñ–∏—á", rarity: "legendary", level: 1, id: 16 },
                { name: "–ö–ª—é—á –æ—Ç –∫–µ–π—Å–∞", price: 0, image: "https://via.placeholder.com/200/33cc33/fff?text=–ö–ª—é—á", rarity: "special", level: 0, id: 17, isKey: true }
            ]
        ];
        
        // –¶–µ–Ω—ã –∫–µ–π—Å–æ–≤
        const casePrices = [100, 300, 500, 1000];
        
        // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–µ–π—Å–æ–≤
        let limitedCasesLeft = 5;
        let legendaryCasesLeft = 3;
        
        // –ò–≥—Ä–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let money = 1000;
        let openedCases = 0;
        let keys = 0;
        let inventory = [];
        let currentItem = null;
        let animationInterval = null;
        let animationSpeed = 30;
        let slowingDown = false;
        let currentPosition = 0;
        let targetPosition = 0;
        let selectedForUpgrade = [];
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞
        function updateBalance() {
            document.getElementById('money').textContent = money;
            document.getElementById('opened-cases').textContent = openedCases;
            document.getElementById('limited-count').textContent = limitedCasesLeft;
            document.getElementById('legendary-count').textContent = legendaryCasesLeft;
            document.getElementById('keys').textContent = keys;
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
        function openTab(tabId) {
            // –°–∫—Ä—ã—Ç—å –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // –£–±—Ä–∞—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫ –≤–∫–ª–∞–¥–æ–∫
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // –ü–æ–∫–∞–∑–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É
            document.getElementById(tabId).classList.add('active');
            
            // –°–¥–µ–ª–∞—Ç—å –∫–Ω–æ–ø–∫—É –∞–∫—Ç–∏–≤–Ω–æ–π
            event.currentTarget.classList.add('active');
            
            // –ï—Å–ª–∏ –æ—Ç–∫—Ä—ã–≤–∞–µ–º –≤–∫–ª–∞–¥–∫—É —É–ª—É—á—à–µ–Ω–∏—è, –æ–±–Ω–æ–≤–ª—è–µ–º –µ–µ
            if (tabId === 'upgrade-tab') {
                updateUpgradeTab();
            }
        }
        
        // –û—Ç–∫—Ä—ã—Ç–∏–µ –∫–µ–π—Å–∞
        function openCase(caseIndex) {
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ –∏ –∫–ª—é—á–µ–π
            if (money < casePrices[caseIndex] && keys === 0) {
                alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤!');
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã—Ö –∫–µ–π—Å–æ–≤
            if (caseIndex === 2 && limitedCasesLeft <= 0) {
                alert('–≠–ø–∏—á–µ—Å–∫–∏–µ –∫–µ–π—Å—ã –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å!');
                return;
            }
            
            if (caseIndex === 3 && legendaryCasesLeft <= 0) {
                alert('–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–µ –∫–µ–π—Å—ã –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å!');
                return;
            }
            
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–ª—é—á –µ—Å–ª–∏ –µ—Å—Ç—å, –∏–Ω–∞—á–µ —Å–ø–∏—Å—ã–≤–∞–µ–º –¥–µ–Ω—å–≥–∏
            if (keys > 0) {
                keys--;
            } else {
                money -= casePrices[caseIndex];
            }
            
            openedCases++;
            if (caseIndex === 2) limitedCasesLeft--;
            if (caseIndex === 3) legendaryCasesLeft--;
            updateBalance();
            
            // –ó–∞–±–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫–∏ –∫–µ–π—Å–æ–≤ –Ω–∞ –≤—Ä–µ–º—è –∞–Ω–∏–º–∞—Ü–∏–∏
            document.querySelectorAll('.case').forEach(c => c.style.pointerEvents = 'none');
            
            // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∞–Ω–∏–º–∞—Ü–∏–∏
            prepareAnimation(caseIndex);
            
            // –ó–∞–ø—É—Å–∫ –∞–Ω–∏–º–∞—Ü–∏–∏
            startAnimation(caseIndex);
        }
        
        // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∞–Ω–∏–º–∞—Ü–∏–∏
        function prepareAnimation(caseIndex) {
            const animationContainer = document.getElementById('animation-container');
            const animationItems = document.getElementById('animation-items');
            
            // –û—á–∏—Å—Ç–∏–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã
            animationItems.innerHTML = '';
            
            // –°–æ–∑–¥–∞–¥–∏–º –º–Ω–æ–≥–æ –∫–æ–ø–∏–π —Ñ–∏–≥—É—Ä–æ–∫ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
            const items = caseItems[caseIndex];
            for (let i = 0; i < 150; i++) {
                const item = items[Math.floor(Math.random() * items.length)];
                const itemElement = document.createElement('div');
                itemElement.className = 'animation-item';
                itemElement.innerHTML = `
                    <img src="${item.image}" alt="${item.name}">
                    <div class="name">${item.name}</div>
                `;
                animationItems.appendChild(itemElement);
            }
            
            // –ü–æ–∫–∞–∂–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∞–Ω–∏–º–∞—Ü–∏–∏
            animationContainer.style.display = 'block';
            
            // –°–∫—Ä—ã–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏ –∫–Ω–æ–ø–∫–∏
            document.getElementById('result').style.display = 'none';
            document.getElementById('buttons').style.display = 'none';
        }
        
        // –ó–∞–ø—É—Å–∫ –∞–Ω–∏–º–∞—Ü–∏–∏
        function startAnimation(caseIndex) {
            const animationItems = document.getElementById('animation-items');
            const items = caseItems[caseIndex];
            
            // –í—ã—á–∏—Å–ª—è–µ–º —Ü–µ–ª–µ–≤—É—é –ø–æ–∑–∏—Ü–∏—é –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ (—Å–ª—É—á–∞–π–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç —Å —É—á–µ—Ç–æ–º —Ä–µ–¥–∫–æ—Å—Ç–∏)
            let totalRarity = items.reduce((sum, item) => sum + getRarityValue(item.rarity), 0);
            let randomValue = Math.random() * totalRarity;
            let selectedItem = null;
            
            for (const item of items) {
                if (randomValue <= getRarityValue(item.rarity)) {
                    selectedItem = item;
                    break;
                }
                randomValue -= getRarityValue(item.rarity);
            }
            
            // –ï—Å–ª–∏ –ø–æ—á–µ–º—É-—Ç–æ –Ω–µ –≤—ã–±—Ä–∞–ª–∏ (–º–∞–ª–æ–≤–µ—Ä–æ—è—Ç–Ω–æ), –±–µ—Ä–µ–º –ø–µ—Ä–≤—ã–π
            if (!selectedItem) selectedItem = items[0];
            
            currentItem = selectedItem;
            
            // –í—ã—á–∏—Å–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é, –≥–¥–µ —ç—Ç–æ—Ç —ç–ª–µ–º–µ–Ω—Ç –±—É–¥–µ—Ç –≤ —Ü–µ–Ω—Ç—Ä–µ
            const itemWidth = 185; // 180px + 5px margin-right
            const containerWidth = document.getElementById('animation-container').offsetWidth;
            const centerPosition = Math.floor(containerWidth / 2) - Math.floor(itemWidth / 2);
            
            // –ù–∞—Ö–æ–¥–∏–º –∏–Ω–¥–µ–∫—Å –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ –≤ –∞–Ω–∏–º–∞—Ü–∏–∏ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 —ç–ª–µ–º–µ–Ω—Ç–æ–≤)
            const animationItemsCount = animationItems.children.length;
            const searchStart = animationItemsCount - 30;
            let targetIndex = -1;
            
            // –ò—â–µ–º –Ω–∞—à –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç –≤ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–∞—Ö
            for (let i = searchStart; i < animationItemsCount; i++) {
                const img = animationItems.children[i].querySelector('img');
                if (img && img.alt === selectedItem.name) {
                    targetIndex = i;
                    break;
                }
            }
            
            // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ (–º–∞–ª–æ–≤–µ—Ä–æ—è—Ç–Ω–æ), –±–µ—Ä–µ–º –ø—Ä–µ–¥–ø–æ—Å–ª–µ–¥–Ω–∏–π
            if (targetIndex === -1) targetIndex = animationItemsCount - 2;
            
            // –í—ã—á–∏—Å–ª—è–µ–º —Ü–µ–ª–µ–≤—É—é –ø–æ–∑–∏—Ü–∏—é –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
            targetPosition = -(targetIndex * itemWidth - centerPosition);
            
            // –ù–∞—á–∏–Ω–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
            currentPosition = 0;
            slowingDown = false;
            animationItems.style.left = currentPosition + 'px';
            
            if (animationInterval) clearInterval(animationInterval);
            
            // –î–æ–±–∞–≤–∏–º –Ω–µ–º–Ω–æ–≥–æ —Å–ª—É—á–∞–π–Ω–æ—Å—Ç–∏ –≤ —Å–∫–æ—Ä–æ—Å—Ç—å –∞–Ω–∏–º–∞—Ü–∏–∏
            const baseSpeed = 30;
            const speedVariation = Math.random() * 20 - 10; // –æ—Ç -10 –¥–æ +10
            animationSpeed = baseSpeed + speedVariation;
            
            animationInterval = setInterval(() => {
                // –ï—Å–ª–∏ –µ—â–µ –Ω–µ –Ω–∞—á–∞–ª–∏ –∑–∞–º–µ–¥–ª—è—Ç—å—Å—è –∏ –ø—Ä–æ—à–ª–∏ 70% –ø—É—Ç–∏
                if (!slowingDown && currentPosition < targetPosition * 0.7) {
                    slowingDown = true;
                    animationSpeed = 150; // –ó–∞–º–µ–¥–ª—è–µ–º—Å—è
                    
                    // –ü–æ–¥—Å–≤–µ—Ç–∏–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å —Ç–∞–∫–∏–º –∂–µ –∏–º–µ–Ω–µ–º
                    const items = document.querySelectorAll('.animation-item');
                    items.forEach(item => {
                        const img = item.querySelector('img');
                        if (img && img.alt === selectedItem.name) {
                            item.classList.add('highlight');
                        }
                    });
                }
                
                // –î–≤–∏–≥–∞–µ–º—Å—è –∫ —Ü–µ–ª–∏
                if (slowingDown) {
                    // –ü—Ä–∏–±–ª–∏–∂–∞–µ–º—Å—è –∫ —Ü–µ–ª–∏ —Å –∑–∞–º–µ–¥–ª–µ–Ω–∏–µ–º
                    const distance = targetPosition - currentPosition;
                    currentPosition += distance * 0.1;
                    
                    // –ï—Å–ª–∏ –æ—á–µ–Ω—å –±–ª–∏–∑–∫–æ, –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º—Å—è
                    if (Math.abs(distance) < 5) {
                        currentPosition = targetPosition;
                        clearInterval(animationInterval);
                        animationItems.style.left = currentPosition + 'px';
                        showResult();
                        return;
                    }
                } else {
                    // –ë—ã—Å—Ç—Ä–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ –≤ –Ω–∞—á–∞–ª–µ
                    currentPosition -= 30;
                }
                
                animationItems.style.left = currentPosition + 'px';
            }, animationSpeed);
        }
        
        // –ü–æ–ª—É—á–∏—Ç—å —á–∏—Å–ª–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Ä–µ–¥–∫–æ—Å—Ç–∏
        function getRarityValue(rarity) {
            switch(rarity) {
                case 'common': return 60;
                case 'rare': return 25;
                case 'epic': return 10;
                case 'legendary': return 5;
                case 'special': return 1;
                default: return 10;
            }
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        function showResult() {
            const resultElement = document.getElementById('result');
            const buttonsElement = document.getElementById('buttons');
            
            resultElement.textContent = `üéâ –í—ã –ø–æ–ª—É—á–∏–ª–∏: ${currentItem.name} (${currentItem.price} ‚ÇΩ) üéâ`;
            resultElement.style.display = 'block';
            buttonsElement.style.display = 'flex';
            
            // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –∫–µ–π—Å—ã
            document.querySelectorAll('.case').forEach(c => c.style.pointerEvents = 'auto');
            
            // –ï—Å–ª–∏ —ç—Ç–æ –∫–ª—é—á, –ø–æ–∫–∞–∂–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            if (currentItem.isKey) {
                keys++;
                updateBalance();
                setTimeout(() => {
                    document.getElementById('key-modal').style.display = 'flex';
                }, 1000);
            }
        }
        
        // –ü—Ä–æ–¥–∞—Ç—å –ø—Ä–µ–¥–º–µ—Ç
        function sellItem() {
            money += currentItem.price;
            updateBalance();
            
            // –≠—Ñ—Ñ–µ–∫—Ç –ø—Ä–æ–¥–∞–∂–∏
            createConfetti(currentItem.rarity);
            
            hideResultElements();
        }
        
        // –û—Å—Ç–∞–≤–∏—Ç—å –ø—Ä–µ–¥–º–µ—Ç –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ
        function keepItem() {
            // –°–æ–∑–¥–∞–µ–º –∫–æ–ø–∏—é –æ–±—ä–µ–∫—Ç–∞, —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –∏–∑–º–µ–Ω—è—Ç—å level –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ
            const itemCopy = JSON.parse(JSON.stringify(currentItem));
            inventory.push(itemCopy);
            updateInventory();
            
            // –≠—Ñ—Ñ–µ–∫—Ç –ø–æ–ª—É—á–µ–Ω–∏—è
            createConfetti(currentItem.rarity);
            
            hideResultElements();
        }
        
        // –°–∫—Ä—ã—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
        function hideResultElements() {
            document.getElementById('animation-container').style.display = 'none';
            document.getElementById('result').style.display = 'none';
            document.getElementById('buttons').style.display = 'none';
            
            // –£–±—Ä–∞—Ç—å –ø–æ–¥—Å–≤–µ—Ç–∫—É
            document.querySelectorAll('.animation-item').forEach(item => {
                item.classList.remove('highlight');
            });
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
        function updateInventory() {
            const inventoryItems = document.getElementById('inventory-items');
            const emptyInventory = document.getElementById('empty-inventory');
            inventoryItems.innerHTML = '';
            
            if (inventory.length === 0) {
                emptyInventory.style.display = 'block';
            } else {
                emptyInventory.style.display = 'none';
                
                inventory.forEach((item, index) => {
                    const itemElement = document.createElement('div');
                    itemElement.className = 'inventory-item';
                    itemElement.innerHTML = `
                        <div class="level">${item.level}</div>
                        <img src="${item.image}" alt="${item.name}">
                        <div class="name">${item.name}</div>
                        <div class="price">${item.price * item.level} ‚ÇΩ</div>
                        <div class="item-actions">
                            <button class="sell-inventory-btn" onclick="sellInventoryItem(${index})">–ü—Ä–æ–¥–∞—Ç—å</button>
                            <button class="upgrade-inventory-btn" onclick="selectForUpgrade(${index})">–í—ã–±—Ä–∞—Ç—å</button>
                        </div>
                    `;
                    inventoryItems.appendChild(itemElement);
                });
            }
        }
        
        // –ü—Ä–æ–¥–∞—Ç—å –ø—Ä–µ–¥–º–µ—Ç –∏–∑ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
        function sellInventoryItem(index) {
            if (index >= 0 && index < inventory.length) {
                const item = inventory[index];
                money += item.price * item.level;
                inventory.splice(index, 1);
                updateBalance();
                updateInventory();
                updateUpgradeTab();
                
                // –≠—Ñ—Ñ–µ–∫—Ç –ø—Ä–æ–¥–∞–∂–∏
                createConfetti(item.rarity);
            }
        }
        
        // –í—ã–±—Ä–∞—Ç—å –ø—Ä–µ–¥–º–µ—Ç –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è
        function selectForUpgrade(index) {
            if (index >= 0 && index < inventory.length) {
                const item = inventory[index];
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –≤—ã–±—Ä–∞–Ω –ª–∏ —É–∂–µ —ç—Ç–æ—Ç –ø—Ä–µ–¥–º–µ—Ç
                const alreadySelected = selectedForUpgrade.some(selected => selected.index === index);
                
                if (alreadySelected) {
                    // –£–±–∏—Ä–∞–µ–º –∏–∑ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö
                    selectedForUpgrade = selectedForUpgrade.filter(selected => selected.index !== index);
                } else {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –º–æ–∂–Ω–æ –ª–∏ –¥–æ–±–∞–≤–∏—Ç—å (–º–∞–∫—Å–∏–º—É–º 2)
                    if (selectedForUpgrade.length < 2) {
                        selectedForUpgrade.push({ index, item });
                    } else {
                        alert('–ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å —Ç–æ–ª—å–∫–æ 2 –ø—Ä–µ–¥–º–µ—Ç–∞ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è!');
                        return;
                    }
                }
                
                updateUpgradeTab();
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–∫–ª–∞–¥–∫–∏ —É–ª—É—á—à–µ–Ω–∏—è
        function updateUpgradeTab() {
            const upgradeItems = document.getElementById('upgrade-items');
            const upgradeBtn = document.getElementById('perform-upgrade');
            const upgradeProgress = document.getElementById('upgrade-progress');
            const upgradeChance = document.getElementById('upgrade-chance');
            
            upgradeItems.innerHTML = '';
            
            if (selectedForUpgrade.length === 0) {
                upgradeBtn.disabled = true;
                upgradeProgress.style.width = '0%';
                upgradeProgress.textContent = '0%';
                upgradeChance.textContent = '0';
                return;
            }
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã
            selectedForUpgrade.forEach((selected, i) => {
                const item = selected.item;
                const itemElement = document.createElement('div');
                itemElement.className = 'upgrade-item';
                itemElement.innerHTML = `
                    <img src="${item.image}" alt="${item.name}">
                    <div class="upgrade-item-info">
                        <div class="upgrade-item-name">${item.name}</div>
                        <div class="upgrade-item-stats">
                            <span class="upgrade-item-price">${item.price * item.level} ‚ÇΩ</span>
                            <span> ‚Ä¢ –£—Ä. ${item.level}</span>
                        </div>
                        <div>–†–µ–¥–∫–æ—Å—Ç—å: <span class="rarity-${item.rarity}">${getRarityName(item.rarity)}</span></div>
                    </div>
                    <button onclick="selectForUpgrade(${selected.index})">‚úï</button>
                `;
                upgradeItems.appendChild(itemElement);
            });
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –º–æ–∂–Ω–æ –ª–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å —É–ª—É—á—à–µ–Ω–∏–µ
            let canUpgrade = true;
            let chance = 0;
            let baseLevel = 0;
            
            if (selectedForUpgrade.length === 2) {
                const item1 = selectedForUpgrade[0].item;
                const item2 = selectedForUpgrade[1].item;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —É—Ä–æ–≤–Ω–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ
                if (item1.level !== item2.level) {
                    canUpgrade = false;
                } else {
                    baseLevel = item1.level;
                    
                    // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —à–∞–Ω—Å —É–ª—É—á—à–µ–Ω–∏—è
                    const rarity1 = getRarityValue(item1.rarity);
                    const rarity2 = getRarityValue(item2.rarity);
                    
                    // –ë–∞–∑–æ–≤—ã–π —à–∞–Ω—Å –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–µ–¥–∫–æ—Å—Ç–∏ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –∏ –∏—Ö —É—Ä–æ–≤–Ω—è
                    chance = Math.min(90, 50 + (100 - (rarity1 + rarity2)/2) - (baseLevel * 10));
                }
            } else {
                canUpgrade = false;
            }
            
            upgradeBtn.disabled = !canUpgrade;
            
            if (canUpgrade) {
                upgradeProgress.style.width = `${chance}%`;
                upgradeProgress.textContent = `${chance}%`;
                upgradeChance.textContent = chance;
            } else {
                upgradeProgress.style.width = '0%';
                upgradeProgress.textContent = '0%';
                upgradeChance.textContent = '0';
            }
        }
        
        // –ü–æ–ª—É—á–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ —Ä–µ–¥–∫–æ—Å—Ç–∏
        function getRarityName(rarity) {
            switch(rarity) {
                case 'common': return '–û–±—ã—á–Ω–∞—è';
                case 'rare': return '–†–µ–¥–∫–∞—è';
                case 'epic': return '–≠–ø–∏—á–µ—Å–∫–∞—è';
                case 'legendary': return '–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω–∞—è';
                case 'special': return '–û—Å–æ–±–∞—è';
                default: return '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è';
            }
        }
        
        // –í—ã–ø–æ–ª–Ω–∏—Ç—å —É–ª—É—á—à–µ–Ω–∏–µ
        function performUpgrade() {
            if (selectedForUpgrade.length !== 2) return;
            
            const index1 = selectedForUpgrade[0].index;
            const index2 = selectedForUpgrade[1].index;
            const item1 = inventory[index1];
            const item2 = inventory[index2];
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø—Ä–µ–¥–º–µ—Ç—ã –µ—â–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç (–Ω–µ –±—ã–ª–∏ –ø—Ä–æ–¥–∞–Ω—ã –∏ —Ç.–¥.)
            if (!item1 || !item2 || item1.level !== item2.level) {
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–ª—É—á—à–µ–Ω–∏–∏!');
                selectedForUpgrade = [];
                updateUpgradeTab();
                return;
            }
            
            const baseLevel = item1.level;
            
            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —à–∞–Ω—Å —É–ª—É—á—à–µ–Ω–∏—è
            const rarity1 = getRarityValue(item1.rarity);
            const rarity2 = getRarityValue(item2.rarity);
            const chance = Math.min(90, 50 + (100 - (rarity1 + rarity2)/2) - (baseLevel * 10));
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            const success = Math.random() * 100 < chance;
            
            // –£–¥–∞–ª—è–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã
            if (index1 > index2) {
                inventory.splice(index1, 1);
                inventory.splice(index2, 1);
            } else {
                inventory.splice(index2, 1);
                inventory.splice(index1, 1);
            }
            
            if (success) {
                // –°–æ–∑–¥–∞–µ–º —É–ª—É—á—à–µ–Ω–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç
                const upgradedItem = {
                    ...item1,
                    level: baseLevel + 1,
                    price: Math.floor(item1.price * 1.5)
                };
                
                inventory.push(upgradedItem);
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                showUpgradeResult(true, upgradedItem);
            } else {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–µ—É–¥–∞—á—É
                showUpgradeResult(false);
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            selectedForUpgrade = [];
            updateInventory();
            updateUpgradeTab();
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç —É–ª—É—á—à–µ–Ω–∏—è
        function showUpgradeResult(success, upgradedItem = null) {
            const modal = document.getElementById('upgrade-modal');
            const title = document.getElementById('upgrade-modal-title');
            const text = document.getElementById('upgrade-modal-text');
            const itemContainer = document.getElementById('upgrade-modal-item');
            
            if (success) {
                title.textContent = 'üéâ –£–ª—É—á—à–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ! üéâ';
                text.textContent = `–í—ã –ø–æ–ª—É—á–∏–ª–∏ –ø—Ä–µ–¥–º–µ—Ç ${upgradedItem.name} —É—Ä–æ–≤–Ω—è ${upgradedItem.level}!`;
                
                itemContainer.innerHTML = `
                    <div style="text-align: center; margin: 20px 0;">
                        <div style="position: relative; display: inline-block;">
                            <img src="${upgradedItem.image}" alt="${upgradedItem.name}" 
                                 style="width: 120px; height: 120px; object-fit: cover; border-radius: 8px; border: 2px solid #ffcc00;">
                            <div style="position: absolute; top: -10px; left: -10px; background-color: #ffcc00; color: #333; 
                                       width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; 
                                       justify-content: center; font-weight: bold;">${upgradedItem.level}</div>
                        </div>
                        <div style="margin-top: 10px; font-weight: bold;">${upgradedItem.name}</div>
                        <div style="color: #ffcc00; font-weight: bold;">${upgradedItem.price * upgradedItem.level} ‚ÇΩ</div>
                    </div>
                `;
                
                // –≠—Ñ—Ñ–µ–∫—Ç —É—Å–ø–µ—Ö–∞
                for (let i = 0; i < 100; i++) {
                    createConfetti(upgradedItem.rarity);
                }
            } else {
                title.textContent = 'üò¢ –£–ª—É—á—à–µ–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å üò¢';
                text.textContent = '–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, —É–ª—É—á—à–µ–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å. –í—ã –ø–æ—Ç–µ—Ä—è–ª–∏ –æ–±–∞ –ø—Ä–µ–¥–º–µ—Ç–∞.';
                itemContainer.innerHTML = '';
                
                // –≠—Ñ—Ñ–µ–∫—Ç –Ω–µ—É–¥–∞—á–∏
                createConfetti('common', 30, '#ff3333');
            }
            
            modal.style.display = 'flex';
        }
        
        // –ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        function closeModal() {
            document.querySelectorAll('.modal').forEach(modal => {
                modal.style.display = 'none';
            });
        }
        
        // –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ñ–µ—Ç—Ç–∏
        function createConfetti(rarity, count = 50, color = null) {
            if (!color) {
                switch(rarity) {
                    case 'common': color = '#aaa'; break;
                    case 'rare': color = '#4d88ff'; break;
                    case 'epic': color = '#b347ea'; break;
                    case 'legendary': color = '#ffaa00'; break;
                    case 'special': color = '#33cc33'; break;
                    default: color = '#ffcc00';
                }
            }
            
            for (let i = 0; i < count; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.backgroundColor = color;
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.width = Math.random() * 10 + 5 + 'px';
                confetti.style.height = Math.random() * 10 + 5 + 'px';
                confetti.style.animationDuration = Math.random() * 3 + 2 + 's';
                confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
                
                document.body.appendChild(confetti);
                
                // –£–¥–∞–ª—è–µ–º –∫–æ–Ω—Ñ–µ—Ç—Ç–∏ –ø–æ—Å–ª–µ –∞–Ω–∏–º–∞—Ü–∏–∏
                setTimeout(() => {
                    confetti.remove();
                }, 5000);
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        updateBalance();
        updateInventory();
        
        // –ü—Ä–∏–º–µ—Ä –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        // inventory.push(...[
        //     { name: "–û–±—ã—á–Ω–∞—è —Ñ–∏–≥—É—Ä–∫–∞ 1", price: 50, image: "https://via.placeholder.com/200/aaa/000?text=–û–±—ã—á1", rarity: "common", level: 1, id: 1 },
        //     { name: "–û–±—ã—á–Ω–∞—è —Ñ–∏–≥—É—Ä–∫–∞ 1", price: 50, image: "https://via.placeholder.com/200/aaa/000?text=–û–±—ã—á1", rarity: "common", level: 1, id: 1 },
        //     { name: "–†–µ–¥–∫–∞—è —Ñ–∏–≥—É—Ä–∫–∞ 1", price: 150, image: "https://via.placeholder.com/200/4d88ff/fff?text=–†–µ–¥–∫1", rarity: "rare", level: 1, id: 3 },
        //     { name: "–†–µ–¥–∫–∞—è —Ñ–∏–≥—É—Ä–∫–∞ 1", price: 150, image: "https://via.placeholder.com/200/4d88ff/fff?text=–†–µ–¥–∫1", rarity: "rare", level: 1, id: 3 }
        // ]);
        // updateInventory();
    </script>
</body>
</html>
